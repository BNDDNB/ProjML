{"nbformat_minor": 2, "cells": [{"execution_count": 1, "cell_type": "code", "source": "from pyspark.sql.types import *\n\nflightSchema = StructType([\n    StructField(\"DayofMonth\",IntegerType(),False),\n    StructField(\"DayofWeek\",IntegerType(),False),\n    StructField(\"Carrier\",StringType(),False),\n    StructField(\"OriginAirportID\",IntegerType(),False),\n    StructField(\"DestAirportID\", IntegerType(),False),\n    StructField(\"DepDelay\", IntegerType(),False),\n    StructField(\"ArrDelay\",IntegerType(),False),\n])\n\nflights = spark.read.csv('wasb:///data/raw-flight-data.csv', schema=flightSchema, header=True)\n", "outputs": [{"output_type": "stream", "name": "stdout", "text": "Starting Spark application\n"}, {"output_type": "display_data", "data": {"text/plain": "<IPython.core.display.HTML object>", "text/html": "<table>\n<tr><th>ID</th><th>YARN Application ID</th><th>Kind</th><th>State</th><th>Spark UI</th><th>Driver log</th><th>Current session?</th></tr><tr><td>5</td><td>application_1516029531965_0009</td><td>pyspark</td><td>idle</td><td><a target=\"_blank\" href=\"http://hn1-spk012.zi1mhgvoalbuxhlxjrtncoyukd.bx.internal.cloudapp.net:8088/proxy/application_1516029531965_0009/\">Link</a></td><td><a target=\"_blank\" href=\"http://10.0.0.7:30060/node/containerlogs/container_1516029531965_0009_01_000001/livy\">Link</a></td><td>\u2714</td></tr></table>"}, "metadata": {}}, {"output_type": "stream", "name": "stdout", "text": "SparkSession available as 'spark'.\n"}], "metadata": {"collapsed": false}}, {"execution_count": 5, "cell_type": "code", "source": "data=flights.dropDuplicates().fillna(value=0, subset=[\"ArrDelay\",\"DepDelay\"])\ndata.count()\n", "outputs": [{"output_type": "stream", "name": "stdout", "text": "2696983"}], "metadata": {"collapsed": false}}, {"execution_count": 7, "cell_type": "code", "source": "data.createOrReplaceTempView(\"flightData\")", "outputs": [], "metadata": {"collapsed": true}}, {"execution_count": 6, "cell_type": "code", "source": "%%sql\nSELECT DepDelay, ArrDelay FROM flightData", "outputs": [{"ename": "AttributeError", "evalue": "'module' object has no attribute 'api'", "traceback": ["\u001b[1;31m\u001b[0m", "\u001b[1;31mAttributeError\u001b[0mTraceback (most recent call last)", "\u001b[1;32m/usr/bin/anaconda/lib/python2.7/site-packages/IPython/core/formatters.pyc\u001b[0m in \u001b[0;36m__call__\u001b[1;34m(self, obj)\u001b[0m\n\u001b[0;32m    902\u001b[0m                 \u001b[1;32mpass\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m    903\u001b[0m             \u001b[1;32melse\u001b[0m\u001b[1;33m:\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[1;32m--> 904\u001b[1;33m                 \u001b[0mprinter\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mobj\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m\u001b[0;32m    905\u001b[0m                 \u001b[1;32mreturn\u001b[0m \u001b[0mTrue\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m    906\u001b[0m             \u001b[1;31m# Finally look for special method names\u001b[0m\u001b[1;33m\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n", "\u001b[1;32m/usr/bin/anaconda/lib/python2.7/site-packages/autovizwidget/widget/utils.pyc\u001b[0m in \u001b[0;36mdisplay_dataframe\u001b[1;34m(df)\u001b[0m\n\u001b[0;32m    114\u001b[0m \u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m    115\u001b[0m \u001b[1;32mdef\u001b[0m \u001b[0mdisplay_dataframe\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mdf\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m:\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[1;32m--> 116\u001b[1;33m     \u001b[0mselected_x\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mselect_x\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mdf\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m\u001b[0;32m    117\u001b[0m     \u001b[0mselected_y\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mselect_y\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mdf\u001b[0m\u001b[1;33m,\u001b[0m \u001b[0mselected_x\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m    118\u001b[0m     encoding = Encoding(chart_type=Encoding.chart_type_table, x=selected_x, y=selected_y,\n", "\u001b[1;32m/usr/bin/anaconda/lib/python2.7/site-packages/autovizwidget/widget/utils.pyc\u001b[0m in \u001b[0;36mselect_x\u001b[1;34m(data, order)\u001b[0m\n\u001b[0;32m     70\u001b[0m         \u001b[0m_validate_custom_order\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0morder\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m     71\u001b[0m \u001b[1;33m\u001b[0m\u001b[0m\n\u001b[1;32m---> 72\u001b[1;33m     \u001b[0md\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0m_classify_data_by_type\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mdata\u001b[0m\u001b[1;33m,\u001b[0m \u001b[0morder\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m\u001b[0;32m     73\u001b[0m \u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m     74\u001b[0m     \u001b[0mchosen_x\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mNone\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n", "\u001b[1;32m/usr/bin/anaconda/lib/python2.7/site-packages/autovizwidget/widget/utils.pyc\u001b[0m in \u001b[0;36m_classify_data_by_type\u001b[1;34m(data, order, skip)\u001b[0m\n\u001b[0;32m     48\u001b[0m     \u001b[1;32mfor\u001b[0m \u001b[0mcolumn_name\u001b[0m \u001b[1;32min\u001b[0m \u001b[0mdata\u001b[0m\u001b[1;33m:\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m     49\u001b[0m         \u001b[1;32mif\u001b[0m \u001b[0mcolumn_name\u001b[0m \u001b[1;32mnot\u001b[0m \u001b[1;32min\u001b[0m \u001b[0mskip\u001b[0m\u001b[1;33m:\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[1;32m---> 50\u001b[1;33m             \u001b[0mtyp\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0minfer_vegalite_type\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mdata\u001b[0m\u001b[1;33m[\u001b[0m\u001b[0mcolumn_name\u001b[0m\u001b[1;33m]\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m\u001b[0;32m     51\u001b[0m             \u001b[0md\u001b[0m\u001b[1;33m[\u001b[0m\u001b[0mtyp\u001b[0m\u001b[1;33m]\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mappend\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mcolumn_name\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m     52\u001b[0m \u001b[1;33m\u001b[0m\u001b[0m\n", "\u001b[1;32m/usr/bin/anaconda/lib/python2.7/site-packages/autovizwidget/widget/utils.pyc\u001b[0m in \u001b[0;36minfer_vegalite_type\u001b[1;34m(data)\u001b[0m\n\u001b[0;32m     14\u001b[0m     \"\"\"\n\u001b[0;32m     15\u001b[0m \u001b[1;33m\u001b[0m\u001b[0m\n\u001b[1;32m---> 16\u001b[1;33m     \u001b[0mtyp\u001b[0m \u001b[1;33m=\u001b[0m \u001b[0mpd\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mapi\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0mtypes\u001b[0m\u001b[1;33m.\u001b[0m\u001b[0minfer_dtype\u001b[0m\u001b[1;33m(\u001b[0m\u001b[0mdata\u001b[0m\u001b[1;33m)\u001b[0m\u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0m\u001b[0;32m     17\u001b[0m \u001b[1;33m\u001b[0m\u001b[0m\n\u001b[0;32m     18\u001b[0m     if typ in ['floating', 'mixed-integer-float', 'integer',\n", "\u001b[1;31mAttributeError\u001b[0m: 'module' object has no attribute 'api'"], "output_type": "error"}, {"execution_count": 6, "output_type": "execute_result", "data": {"text/plain": "      DepDelay  ArrDelay\n0            1         3\n1            1        -2\n2           -3       -12\n3           85        95\n4           -2       -17\n5           -5        -3\n6           -1       -18\n7           -2        -6\n8           -5         2\n9           -3       -16\n10          -1        -2\n11          -5       -10\n12          -6        -2\n13          21        16\n14         -14       -17\n15          -6       -22\n16          -3       -10\n17           6        -1\n18           0        10\n19          -2        -6\n20          -4       -13\n21          -5       -15\n22          21       -13\n23           0        -7\n24          -7       -10\n25          -3       -17\n26         -10       -28\n27          10       -12\n28          -6       -15\n29          -4        -2\n...        ...       ...\n2470        -5         4\n2471         0        -8\n2472        -6       -47\n2473        21        14\n2474         9        -1\n2475         0        12\n2476       -10        19\n2477        15         1\n2478         3        -3\n2479         2        -2\n2480        -4       -19\n2481        -9       -10\n2482        -1       -21\n2483        76        77\n2484        -8        -2\n2485        -5       -24\n2486        -2         6\n2487        -3       -10\n2488         0         3\n2489        -2        -9\n2490        -2       -23\n2491        -6        -4\n2492        40        23\n2493         4         4\n2494        94        91\n2495        -7       -16\n2496        -4        -3\n2497        -6         0\n2498        91        74\n2499        -2       -21\n\n[2500 rows x 2 columns]", "text/html": "<div>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>DepDelay</th>\n      <th>ArrDelay</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1</td>\n      <td>-2</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>-3</td>\n      <td>-12</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>85</td>\n      <td>95</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>-2</td>\n      <td>-17</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>-5</td>\n      <td>-3</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>-1</td>\n      <td>-18</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>-2</td>\n      <td>-6</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>-5</td>\n      <td>2</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>-3</td>\n      <td>-16</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>-1</td>\n      <td>-2</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>-5</td>\n      <td>-10</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>-6</td>\n      <td>-2</td>\n    </tr>\n    <tr>\n      <th>13</th>\n      <td>21</td>\n      <td>16</td>\n    </tr>\n    <tr>\n      <th>14</th>\n      <td>-14</td>\n      <td>-17</td>\n    </tr>\n    <tr>\n      <th>15</th>\n      <td>-6</td>\n      <td>-22</td>\n    </tr>\n    <tr>\n      <th>16</th>\n      <td>-3</td>\n      <td>-10</td>\n    </tr>\n    <tr>\n      <th>17</th>\n      <td>6</td>\n      <td>-1</td>\n    </tr>\n    <tr>\n      <th>18</th>\n      <td>0</td>\n      <td>10</td>\n    </tr>\n    <tr>\n      <th>19</th>\n      <td>-2</td>\n      <td>-6</td>\n    </tr>\n    <tr>\n      <th>20</th>\n      <td>-4</td>\n      <td>-13</td>\n    </tr>\n    <tr>\n      <th>21</th>\n      <td>-5</td>\n      <td>-15</td>\n    </tr>\n    <tr>\n      <th>22</th>\n      <td>21</td>\n      <td>-13</td>\n    </tr>\n    <tr>\n      <th>23</th>\n      <td>0</td>\n      <td>-7</td>\n    </tr>\n    <tr>\n      <th>24</th>\n      <td>-7</td>\n      <td>-10</td>\n    </tr>\n    <tr>\n      <th>25</th>\n      <td>-3</td>\n      <td>-17</td>\n    </tr>\n    <tr>\n      <th>26</th>\n      <td>-10</td>\n      <td>-28</td>\n    </tr>\n    <tr>\n      <th>27</th>\n      <td>10</td>\n      <td>-12</td>\n    </tr>\n    <tr>\n      <th>28</th>\n      <td>-6</td>\n      <td>-15</td>\n    </tr>\n    <tr>\n      <th>29</th>\n      <td>-4</td>\n      <td>-2</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>2470</th>\n      <td>-5</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>2471</th>\n      <td>0</td>\n      <td>-8</td>\n    </tr>\n    <tr>\n      <th>2472</th>\n      <td>-6</td>\n      <td>-47</td>\n    </tr>\n    <tr>\n      <th>2473</th>\n      <td>21</td>\n      <td>14</td>\n    </tr>\n    <tr>\n      <th>2474</th>\n      <td>9</td>\n      <td>-1</td>\n    </tr>\n    <tr>\n      <th>2475</th>\n      <td>0</td>\n      <td>12</td>\n    </tr>\n    <tr>\n      <th>2476</th>\n      <td>-10</td>\n      <td>19</td>\n    </tr>\n    <tr>\n      <th>2477</th>\n      <td>15</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>2478</th>\n      <td>3</td>\n      <td>-3</td>\n    </tr>\n    <tr>\n      <th>2479</th>\n      <td>2</td>\n      <td>-2</td>\n    </tr>\n    <tr>\n      <th>2480</th>\n      <td>-4</td>\n      <td>-19</td>\n    </tr>\n    <tr>\n      <th>2481</th>\n      <td>-9</td>\n      <td>-10</td>\n    </tr>\n    <tr>\n      <th>2482</th>\n      <td>-1</td>\n      <td>-21</td>\n    </tr>\n    <tr>\n      <th>2483</th>\n      <td>76</td>\n      <td>77</td>\n    </tr>\n    <tr>\n      <th>2484</th>\n      <td>-8</td>\n      <td>-2</td>\n    </tr>\n    <tr>\n      <th>2485</th>\n      <td>-5</td>\n      <td>-24</td>\n    </tr>\n    <tr>\n      <th>2486</th>\n      <td>-2</td>\n      <td>6</td>\n    </tr>\n    <tr>\n      <th>2487</th>\n      <td>-3</td>\n      <td>-10</td>\n    </tr>\n    <tr>\n      <th>2488</th>\n      <td>0</td>\n      <td>3</td>\n    </tr>\n    <tr>\n      <th>2489</th>\n      <td>-2</td>\n      <td>-9</td>\n    </tr>\n    <tr>\n      <th>2490</th>\n      <td>-2</td>\n      <td>-23</td>\n    </tr>\n    <tr>\n      <th>2491</th>\n      <td>-6</td>\n      <td>-4</td>\n    </tr>\n    <tr>\n      <th>2492</th>\n      <td>40</td>\n      <td>23</td>\n    </tr>\n    <tr>\n      <th>2493</th>\n      <td>4</td>\n      <td>4</td>\n    </tr>\n    <tr>\n      <th>2494</th>\n      <td>94</td>\n      <td>91</td>\n    </tr>\n    <tr>\n      <th>2495</th>\n      <td>-7</td>\n      <td>-16</td>\n    </tr>\n    <tr>\n      <th>2496</th>\n      <td>-4</td>\n      <td>-3</td>\n    </tr>\n    <tr>\n      <th>2497</th>\n      <td>-6</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>2498</th>\n      <td>91</td>\n      <td>74</td>\n    </tr>\n    <tr>\n      <th>2499</th>\n      <td>-2</td>\n      <td>-21</td>\n    </tr>\n  </tbody>\n</table>\n<p>2500 rows \u00d7 2 columns</p>\n</div>"}, "metadata": {}}], "metadata": {"collapsed": false}}, {"execution_count": null, "cell_type": "code", "source": "", "outputs": [], "metadata": {"collapsed": true}}], "nbformat": 4, "metadata": {"kernelspec": {"display_name": "PySpark", "name": "pysparkkernel", "language": ""}, "language_info": {"mimetype": "text/x-python", "pygments_lexer": "python2", "name": "pyspark", "codemirror_mode": {"version": 2, "name": "python"}}}}